2025-06-23 19:51:01,834 - INFO - Building image: ghcr.io/all-hands-ai/runtime:oh_v0.40.0_5ooq6b9rdwohyu17_634egmkijx387tjz
2025-06-23 19:55:58,526 - INFO - Image [ghcr.io/all-hands-ai/runtime:oh_v0.40.0_5ooq6b9rdwohyu17_634egmkijx387tjz] build finished.
2025-06-23 19:55:58,537 - INFO - Re-tagged image [ghcr.io/all-hands-ai/runtime:oh_v0.40.0_5ooq6b9rdwohyu17_634egmkijx387tjz] with more generic tag [oh_v0.40.0_5ooq6b9rdwohyu17]
2025-06-23 19:55:58,541 - INFO - Image ghcr.io/all-hands-ai/runtime with tags [oh_v0.40.0_5ooq6b9rdwohyu17_634egmkijx387tjz, oh_v0.40.0_5ooq6b9rdwohyu17] built successfully
2025-06-23 19:55:58,566 - INFO - [runtime a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Starting runtime with image: ghcr.io/all-hands-ai/runtime:oh_v0.40.0_5ooq6b9rdwohyu17_634egmkijx387tjz
2025-06-23 19:55:59,074 - INFO - [runtime a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Container started: openhands-runtime-a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d. VSCode URL: None
2025-06-23 19:55:59,075 - INFO - [runtime a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Waiting for client to become ready at http://localhost:39047...
2025-06-23 19:56:35,277 - INFO - [runtime a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Runtime is ready.
2025-06-23 19:56:37,875 - INFO - ------------------------------
2025-06-23 19:56:37,876 - INFO - BEGIN Runtime Initialization Fn
2025-06-23 19:56:37,876 - INFO - ------------------------------
2025-06-23 19:56:37,877 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
echo 'export SWE_INSTANCE_ID=matplotlib__matplotlib-25960' >> ~/.bashrc && echo 'export PIP_CACHE_DIR=~/.cache/pip' >> ~/.bashrc && echo "alias git='git --no-pager'" >> ~/.bashrc && git config --global core.pager "" && git config --global diff.binary false
2025-06-23 19:56:38,522 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:38,523 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
export USER=$(whoami); echo USER=${USER} 
2025-06-23 19:56:39,164 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
USER=root
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:39,166 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
mkdir -p /swe_util/eval_data/instances
2025-06-23 19:56:39,806 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:39,820 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cat ~/.bashrc
2025-06-23 19:56:40,463 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
source /opt/miniconda3/etc/profile.d/conda.sh && conda activate testbed

. "/openhands/bin/env"
export ENABLE_AUTO_LINT=true
export NO_CHANGE_TIMEOUT_SECONDS=30
export SWE_INSTANCE_ID=matplotlib__matplotlib-25960
export PIP_CACHE_DIR=~/.cache/pip
alias git='git --no-pager'
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:40,464 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source ~/.bashrc
2025-06-23 19:56:41,104 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:41,105 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source /swe_util/instance_swe_entry.sh
2025-06-23 19:56:42,249 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
WORKSPACE_NAME: matplotlib__matplotlib__3.7
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:42,250 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/matplotlib__matplotlib__3.7
2025-06-23 19:56:42,893 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:42,893 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git reset --hard
2025-06-23 19:56:44,040 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
HEAD is now at 1d0d255b79 Merge pull request #26154 from tacaswell/fix/py312_itertools
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:44,040 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for remote_name in $(git remote); do git remote remove "${remote_name}"; done
2025-06-23 19:56:44,685 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:44,686 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
which python
2025-06-23 19:56:45,328 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
/opt/miniconda3/envs/testbed/bin/python
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:56:45,329 - INFO - ------------------------------
2025-06-23 19:56:45,329 - INFO - END Runtime Initialization Fn
2025-06-23 19:56:45,330 - INFO - ------------------------------
2025-06-23 19:56:45,348 - INFO - [runtime a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Selected repo: None, loading microagents from /workspace/.openhands/microagents (inside runtime)
2025-06-23 19:56:45,353 - INFO - Loading user workspace microagents: []
2025-06-23 19:56:45,353 - INFO - [Agent Controller a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] AgentController a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d - created new state. start_id: 0
2025-06-23 19:56:45,360 - INFO - [Agent Controller a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING
2025-06-23 19:56:45,361 - INFO - Microagent 'gitlab' triggered by keyword 'git'
2025-06-23 19:56:45,362 - INFO - Microagent 'github' triggered by keyword 'github'
2025-06-23 19:59:36,040 - INFO - [Agent Controller a2500fc1-2166-417b-a9a7-e57e1ea49e6f-90170a20ade2954d] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.FINISHED
2025-06-23 19:59:36,552 - INFO - ------------------------------
2025-06-23 19:59:36,552 - INFO - BEGIN Runtime Completion Fn
2025-06-23 19:59:36,552 - INFO - ------------------------------
2025-06-23 19:59:36,553 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/matplotlib__matplotlib__3.7
2025-06-23 19:59:37,194 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:37,195 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git config --global core.pager ""
2025-06-23 19:59:37,838 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:37,839 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
find . -type d -name .git -not -path "./.git"
2025-06-23 19:59:38,485 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:38,485 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git add -A
2025-06-23 19:59:39,125 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:39,125 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for file in $(git status --porcelain | grep -E "^(M| M|\?\?|A| A)" | cut -c4-); do
        if [ -f "$file" ] && (file "$file" | grep -q "executable" || git check-attr binary "$file" | grep -q "binary: set"); then
            git rm -f "$file" 2>/dev/null || rm -f "$file"
            echo "Removed: $file"
        fi
    done
2025-06-23 19:59:39,776 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:39,777 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git diff --no-color --cached 1d0d255b79e84dfc9f2123c5eb85a842d342f72b > patch.diff
2025-06-23 19:59:40,415 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "6ac5bf0ac2a0",
  "working_dir": "/workspace/matplotlib__matplotlib__3.7",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.7]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2025-06-23 19:59:40,415 - INFO - FileReadAction(path='patch.diff', start=0, end=-1, thought='', action=<ActionType.READ: 'read'>, security_risk=None, impl_source=<FileReadSource.DEFAULT: 'default'>, view_range=None)
2025-06-23 19:59:40,420 - INFO - [Read from /workspace/matplotlib__matplotlib__3.7/patch.diff is successful.]
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index dab2bc4a5a..6bbc3d0f17 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2276,10 +2276,25 @@ class SubFigure(FigureBase):
         gs = self._subplotspec.get_gridspec()
         wr = np.asarray(gs.get_width_ratios())
         hr = np.asarray(gs.get_height_ratios())
-        dx = wr[self._subplotspec.colspan].sum() / wr.sum()
-        dy = hr[self._subplotspec.rowspan].sum() / hr.sum()
-        x0 = wr[:self._subplotspec.colspan.start].sum() / wr.sum()
-        y0 = 1 - hr[:self._subplotspec.rowspan.stop].sum() / hr.sum()
+        wspace = gs.get_wspace()
+        hspace = gs.get_hspace()
+        
+        # Calculate dimensions accounting for spacing
+        ncols = len(wr)
+        nrows = len(hr)
+        total_w = wr.sum() + wspace * (ncols - 1)
+        total_h = hr.sum() + hspace * (nrows - 1)
+        
+        # Calculate position and size
+        dx = (wr[self._subplotspec.colspan].sum() + 
+              wspace * (len(self._subplotspec.colspan) - 1)) / total_w
+        dy = (hr[self._subplotspec.rowspan].sum() + 
+              hspace * (len(self._subplotspec.rowspan) - 1)) / total_h
+        x0 = (wr[:self._subplotspec.colspan.start].sum() + 
+              wspace * self._subplotspec.colspan.start) / total_w
+        y0 = 1 - (hr[:self._subplotspec.rowspan.stop].sum() + 
+                  hspace * self._subplotspec.rowspan.stop) / total_h
+        
         if self.bbox_relative is None:
             self.bbox_relative = Bbox.from_bounds(x0, y0, dx, dy)
         else:
diff --git a/test_large_spacing.png b/test_large_spacing.png
new file mode 100644
index 0000000000..63ecf6a312
Binary files /dev/null and b/test_large_spacing.png differ
diff --git a/test_subfigures.py b/test_subfigures.py
new file mode 100644
index 0000000000..1df3c7b82a
--- /dev/null
+++ b/test_subfigures.py
@@ -0,0 +1,17 @@
+import matplotlib.pyplot as plt
+
+# Test with zero spacing
+fig1 = plt.figure()
+figs1 = fig1.subfigures(2, 2, wspace=0, hspace=0)
+for fig in figs1.flat:
+    fig.subplots().plot([1, 2])
+fig1.savefig('test_zero_spacing.png')
+
+# Test with large spacing
+fig2 = plt.figure()
+figs2 = fig2.subfigures(2, 2, wspace=0.5, hspace=0.5)
+for fig in figs2.flat:
+    fig.subplots().plot([1, 2])
+fig2.savefig('test_large_spacing.png')
+
+print("Test scripts created successfully")
diff --git a/test_zero_spacing.png b/test_zero_spacing.png
new file mode 100644
index 0000000000..63ecf6a312
Binary files /dev/null and b/test_zero_spacing.png differ

2025-06-23 19:59:40,421 - INFO - ------------------------------
2025-06-23 19:59:40,422 - INFO - END Runtime Completion Fn
2025-06-23 19:59:40,422 - INFO - ------------------------------
2025-06-23 19:59:40,422 - INFO - Got git diff for instance matplotlib__matplotlib-25960:
--------
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index dab2bc4a5a..6bbc3d0f17 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2276,10 +2276,25 @@ class SubFigure(FigureBase):
         gs = self._subplotspec.get_gridspec()
         wr = np.asarray(gs.get_width_ratios())
         hr = np.asarray(gs.get_height_ratios())
-        dx = wr[self._subplotspec.colspan].sum() / wr.sum()
-        dy = hr[self._subplotspec.rowspan].sum() / hr.sum()
-        x0 = wr[:self._subplotspec.colspan.start].sum() / wr.sum()
-        y0 = 1 - hr[:self._subplotspec.rowspan.stop].sum() / hr.sum()
+        wspace = gs.get_wspace()
+        hspace = gs.get_hspace()
+        
+        # Calculate dimensions accounting for spacing
+        ncols = len(wr)
+        nrows = len(hr)
+        total_w = wr.sum() + wspace * (ncols - 1)
+        total_h = hr.sum() + hspace * (nrows - 1)
+        
+        # Calculate position and size
+        dx = (wr[self._subplotspec.colspan].sum() + 
+              wspace * (len(self._subplotspec.colspan) - 1)) / total_w
+        dy = (hr[self._subplotspec.rowspan].sum() + 
+              hspace * (len(self._subplotspec.rowspan) - 1)) / total_h
+        x0 = (wr[:self._subplotspec.colspan.start].sum() + 
+              wspace * self._subplotspec.colspan.start) / total_w
+        y0 = 1 - (hr[:self._subplotspec.rowspan.stop].sum() + 
+                  hspace * self._subplotspec.rowspan.stop) / total_h
+        
         if self.bbox_relative is None:
             self.bbox_relative = Bbox.from_bounds(x0, y0, dx, dy)
         else:
diff --git a/test_subfigures.py b/test_subfigures.py
new file mode 100644
index 0000000000..1df3c7b82a
--- /dev/null
+++ b/test_subfigures.py
@@ -0,0 +1,17 @@
+import matplotlib.pyplot as plt
+
+# Test with zero spacing
+fig1 = plt.figure()
+figs1 = fig1.subfigures(2, 2, wspace=0, hspace=0)
+for fig in figs1.flat:
+    fig.subplots().plot([1, 2])
+fig1.savefig('test_zero_spacing.png')
+
+# Test with large spacing
+fig2 = plt.figure()
+figs2 = fig2.subfigures(2, 2, wspace=0.5, hspace=0.5)
+for fig in figs2.flat:
+    fig.subplots().plot([1, 2])
+fig2.savefig('test_large_spacing.png')
+
+print("Test scripts created successfully")
--------
2025-06-23 19:59:42,569 - INFO - Using instance container image: swebench/sweb.eval.x86_64.django_1776_django-13513:latest. Please make sure this image exists. Submit an issue on https://github.com/All-Hands-AI/OpenHands if you run into any issues.
2025-06-23 19:59:42,570 - INFO - Resource mapping for princeton-nlp__SWE-bench_Verified-test not found.
2025-06-23 19:59:42,570 - INFO - Logging LLM completions for instance django__django-13513 to evaluation/evaluation_outputs/outputs/princeton-nlp__SWE-bench_Verified-test/CodeActAgent/deepseek-chat_maxiter_100_N_v0.40.0-no-hint-run_1/llm_completions/django__django-13513
