2025-06-27 15:31:36,578 - INFO - Creating container for pydata__xarray-3677...
2025-06-27 15:31:36,668 - INFO - Container for pydata__xarray-3677 created: a55d8f253741f0faae96d0ed30c4bff99cd8812484c64ff7fd60d67822417079
2025-06-27 15:31:36,913 - INFO - Container for pydata__xarray-3677 started: a55d8f253741f0faae96d0ed30c4bff99cd8812484c64ff7fd60d67822417079
2025-06-27 15:31:36,914 - INFO - Intermediate patch for pydata__xarray-3677 written to logs/run_evaluation/20250627_135628/deepseek-chat_maxiter_100_N_v0.40.0-no-hint-run_1/pydata__xarray-3677/patch.diff, now applying to container...
2025-06-27 15:31:37,076 - INFO - >>>>> Applied Patch:
/tmp/patch.diff:40: trailing whitespace.
    
/tmp/patch.diff:43: trailing whitespace.
    
Checking patch merge_utils.py...
/tmp/patch.diff:22: new blank line at EOF.
+
Checking patch minimal_merge_test.py...
/tmp/patch.diff:57: new blank line at EOF.
+
Checking patch standalone_merge_test.py...
/tmp/patch.diff:91: new blank line at EOF.
+
Checking patch test_merge_fix.py...
Checking patch xarray/core/dataset.py...
Checking patch xarray/core/merge.py...
Checking patch xarray/utils/merge_utils.py...
Applied patch merge_utils.py cleanly.
Applied patch minimal_merge_test.py cleanly.
Applied patch standalone_merge_test.py cleanly.
Applied patch test_merge_fix.py cleanly.
Applied patch xarray/core/dataset.py cleanly.
Applied patch xarray/core/merge.py cleanly.
Applied patch xarray/utils/merge_utils.py cleanly.
warning: squelched 1 whitespace error
warning: 6 lines add whitespace errors.

2025-06-27 15:31:37,210 - INFO - Git diff before:
diff --git a/xarray/core/dataset.py b/xarray/core/dataset.py
index ac0a923d..8d20e8aa 100644
--- a/xarray/core/dataset.py
+++ b/xarray/core/dataset.py
@@ -3604,9 +3604,10 @@ class Dataset(Mapping, ImplementsDatasetReduce, DataWithCoords):
             If any variables conflict (see ``compat``).
         """
         _check_inplace(inplace)
+        other_converted = other.to_dataset() if hasattr(other, 'to_dataset') else other
         merge_result = dataset_merge_method(
             self,
-            other,
+            other_converted,
             overwrite_vars=overwrite_vars,
             compat=compat,
             join=join,
diff --git a/xarray/core/merge.py b/xarray/core/merge.py
index 10c7804d..6ab7f1fe 100644
--- a/xarray/core/merge.py
+++ b/xarray/core/merge.py
@@ -19,13 +19,13 @@ import pandas as pd
 
 from . import dtypes, pdcompat
 from .alignment import deep_align
+from .dataarray import DataArray
 from .duck_array_ops import lazy_array_equiv
 from .utils import Frozen, dict_equiv
 from .variable import Variable, as_variable, assert_unique_multiindex_level_names
 
 if TYPE_CHECKING:
     from .coordinates import Coordinates
-    from .dataarray import DataArray
     from .dataset import Dataset
 
     DimsLike = Union[Hashable, Sequence[Hashable]]
@@ -814,16 +814,20 @@ def dataset_merge_method(
     else:
         overwrite_vars = {overwrite_vars}
 
+    try:
+        other_dataset = other.to_dataset() if hasattr(other, 'to_dataset') else other
+    except Exception:
+        other_dataset = other
     if not overwrite_vars:
-        objs = [dataset, other]
+        objs = [dataset, other_dataset]
         priority_arg = None
-    elif overwrite_vars == set(other):
-        objs = [dataset, other]
+    elif overwrite_vars == set(other_dataset):
+        objs = [dataset, other_dataset]
         priority_arg = 1
     else:
         other_overwrite: Dict[Hashable, CoercibleValue] = {}
         other_no_overwrite: Dict[Hashable, CoercibleValue] = {}
-        for k, v in other.items():
+        for k, v in other_dataset.items():
             if k in overwrite_vars:
                 other_overwrite[k] = v
             else:
2025-06-27 15:31:37,211 - INFO - Eval script for pydata__xarray-3677 written to logs/run_evaluation/20250627_135628/deepseek-chat_maxiter_100_N_v0.40.0-no-hint-run_1/pydata__xarray-3677/eval.sh; copying to container...
2025-06-27 15:31:41,984 - INFO - Test runtime: 4.68 seconds
2025-06-27 15:31:41,984 - INFO - Test output for pydata__xarray-3677 written to logs/run_evaluation/20250627_135628/deepseek-chat_maxiter_100_N_v0.40.0-no-hint-run_1/pydata__xarray-3677/test_output.txt
2025-06-27 15:31:42,076 - INFO - Git diff after:
diff --git a/xarray/core/dataset.py b/xarray/core/dataset.py
index ac0a923d..8d20e8aa 100644
--- a/xarray/core/dataset.py
+++ b/xarray/core/dataset.py
@@ -3604,9 +3604,10 @@ class Dataset(Mapping, ImplementsDatasetReduce, DataWithCoords):
             If any variables conflict (see ``compat``).
         """
         _check_inplace(inplace)
+        other_converted = other.to_dataset() if hasattr(other, 'to_dataset') else other
         merge_result = dataset_merge_method(
             self,
-            other,
+            other_converted,
             overwrite_vars=overwrite_vars,
             compat=compat,
             join=join,
diff --git a/xarray/core/merge.py b/xarray/core/merge.py
index 10c7804d..6ab7f1fe 100644
--- a/xarray/core/merge.py
+++ b/xarray/core/merge.py
@@ -19,13 +19,13 @@ import pandas as pd
 
 from . import dtypes, pdcompat
 from .alignment import deep_align
+from .dataarray import DataArray
 from .duck_array_ops import lazy_array_equiv
 from .utils import Frozen, dict_equiv
 from .variable import Variable, as_variable, assert_unique_multiindex_level_names
 
 if TYPE_CHECKING:
     from .coordinates import Coordinates
-    from .dataarray import DataArray
     from .dataset import Dataset
 
     DimsLike = Union[Hashable, Sequence[Hashable]]
@@ -814,16 +814,20 @@ def dataset_merge_method(
     else:
         overwrite_vars = {overwrite_vars}
 
+    try:
+        other_dataset = other.to_dataset() if hasattr(other, 'to_dataset') else other
+    except Exception:
+        other_dataset = other
     if not overwrite_vars:
-        objs = [dataset, other]
+        objs = [dataset, other_dataset]
         priority_arg = None
-    elif overwrite_vars == set(other):
-        objs = [dataset, other]
+    elif overwrite_vars == set(other_dataset):
+        objs = [dataset, other_dataset]
         priority_arg = 1
     else:
         other_overwrite: Dict[Hashable, CoercibleValue] = {}
         other_no_overwrite: Dict[Hashable, CoercibleValue] = {}
-        for k, v in other.items():
+        for k, v in other_dataset.items():
             if k in overwrite_vars:
                 other_overwrite[k] = v
             else:
2025-06-27 15:31:42,076 - INFO - Grading answer for pydata__xarray-3677...
2025-06-27 15:31:42,077 - INFO - report: {'pydata__xarray-3677': {'patch_is_None': False, 'patch_exists': True, 'patch_successfully_applied': True, 'resolved': False, 'tests_status': {'FAIL_TO_PASS': {'success': [], 'failure': ['xarray/tests/test_merge.py::TestMergeMethod::test_merge_dataarray']}, 'PASS_TO_PASS': {'success': [], 'failure': ['xarray/tests/test_merge.py::TestMergeInternals::test_broadcast_dimension_size', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_arrays', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_datasets', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_dataarray_unnamed', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_dicts_simple', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_dicts_dims', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_error', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_alignment_error', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_wrong_input_error', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_no_conflicts_single_var', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_no_conflicts_multi_var', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_no_conflicts_preserve_attrs', 'xarray/tests/test_merge.py::TestMergeFunction::test_merge_no_conflicts_broadcast', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_broadcast_equals', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_compat', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_auto_align', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_fill_value[fill_value0]', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_fill_value[2]', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_fill_value[2.0]', 'xarray/tests/test_merge.py::TestMergeMethod::test_merge_no_conflicts']}, 'FAIL_TO_FAIL': {'success': [], 'failure': []}, 'PASS_TO_FAIL': {'success': [], 'failure': []}}}}
Result for pydata__xarray-3677: resolved: False
2025-06-27 15:31:42,077 - INFO - Attempting to stop container sweb.eval.pydata__xarray-3677.20250627_135628...
2025-06-27 15:31:57,246 - INFO - Attempting to remove container sweb.eval.pydata__xarray-3677.20250627_135628...
2025-06-27 15:31:57,255 - INFO - Container sweb.eval.pydata__xarray-3677.20250627_135628 removed.
