{
  "directed": true,
  "multigraph": true,
  "graph": {
    "resolution_status": "resolved",
    "instance_name": "astropy__astropy-12907",
    "difficulty": "15 min - 1 hour",
    "golden_patch_difficulty": "easy",
    "golden_files_change": 1,
    "patch_difficulty": "medium",
    "files_change": 2
  },
  "nodes": [
    {
      "label": "empty action",
      "args": {},
      "phase": "general",
      "step_indices": [
        0
      ],
      "id": "0:empty action"
    },
    {
      "label": "cd",
      "args": [
        "/workspace/astropy__astropy__4.3"
      ],
      "phase": "general",
      "step_indices": [
        1
      ],
      "id": "1:cd"
    },
    {
      "label": "\nfind",
      "args": [
        ".",
        "*.py",
        "|",
        "grep",
        "|",
        "grep"
      ],
      "phase": "general",
      "step_indices": [
        1
      ],
      "id": "2:\nfind"
    },
    {
      "label": "\nfind",
      "args": [
        ".",
        "*.py",
        "|",
        "grep"
      ],
      "phase": "general",
      "step_indices": [
        1
      ],
      "id": "3:\nfind"
    },
    {
      "label": "\nls",
      "args": [
        "astropy/modeling/"
      ],
      "phase": "general",
      "step_indices": [
        1
      ],
      "id": "4:\nls"
    },
    {
      "label": "str_replace_editor\nview",
      "args": {
        "path": "/workspace/astropy__astropy__4.3/astropy/modeling/separable.py"
      },
      "phase": "localization",
      "step_indices": [
        2
      ],
      "id": "5:str_replace_editor\nview"
    },
    {
      "label": "complex_command",
      "args": [
        "cat << 'EOF' > test_separability.py\nfrom astropy.modeling import models as m\nfrom astropy.modeling.separable import separability_matrix\n\n# Simple case - works correctly\ncm = m.Linear1D(10) & m.Linear1D(5)\nprint(\"Simple case:\")\nprint(separability_matrix(cm))\n\n# Complex case - works correctly\nprint(\"\\nComplex case:\")\nprint(separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5)))\n\n# Nested case - shows the issue\nprint(\"\\nNested case:\")\nprint(separability_matrix(m.Pix2Sky_TAN() & cm))\nEOF"
      ],
      "phase": "general",
      "step_indices": [
        3
      ],
      "id": "6:complex_command"
    },
    {
      "label": "python",
      "args": [
        "test_separability.py"
      ],
      "phase": "verification",
      "step_indices": [
        4,
        6
      ],
      "id": "7:python"
    },
    {
      "label": "str_replace_editor\nstr_replace",
      "args": {
        "path": "/workspace/astropy__astropy__4.3/astropy/modeling/separable.py",
        "old_str": "    if isinstance(left, Model):\n        cleft = _coord_matrix(left, 'left', noutp)\n    else:\n        cleft = np.zeros((noutp, left.shape[1]))\n        cleft[: left.shape[0], : left.shape[1]] = left\n    if isinstance(right, Model):\n        cright = _coord_matrix(right, 'right', noutp)\n    else:\n        cright = np.zeros((noutp, right.shape[1]))\n        cright[-right.shape[0]:, -right.shape[1]:] = 1",
        "new_str": "    if isinstance(left, Model) and not isinstance(left, np.ndarray):\n        cleft = _coord_matrix(left, 'left', noutp)\n    else:\n        cleft = np.zeros((noutp, left.shape[1]))\n        cleft[: left.shape[0], : left.shape[1]] = left\n    if isinstance(right, Model) and not isinstance(right, np.ndarray):\n        cright = _coord_matrix(right, 'right', noutp)\n    else:\n        cright = np.zeros((noutp, right.shape[1]))\n        cright[-right.shape[0]:, -right.shape[1]:] = right",
        "edit_status": "success"
      },
      "phase": "patch",
      "step_indices": [
        5
      ],
      "id": "8:str_replace_editor\nstr_replace"
    }
  ],
  "edges": [
    {
      "label": "1",
      "type": "exec",
      "source": "0:empty action",
      "target": "1:cd",
      "key": 0
    },
    {
      "label": "1",
      "type": "exec",
      "source": "1:cd",
      "target": "2:\nfind",
      "key": 0
    },
    {
      "label": "1",
      "type": "exec",
      "source": "2:\nfind",
      "target": "3:\nfind",
      "key": 0
    },
    {
      "label": "1",
      "type": "exec",
      "source": "3:\nfind",
      "target": "4:\nls",
      "key": 0
    },
    {
      "label": "2",
      "type": "exec",
      "source": "4:\nls",
      "target": "5:str_replace_editor\nview",
      "key": 0
    },
    {
      "label": "3",
      "type": "exec",
      "source": "5:str_replace_editor\nview",
      "target": "6:complex_command",
      "key": 0
    },
    {
      "label": "4",
      "type": "exec",
      "source": "6:complex_command",
      "target": "7:python",
      "key": 0
    },
    {
      "label": "5",
      "type": "exec",
      "source": "7:python",
      "target": "8:str_replace_editor\nstr_replace",
      "key": 0
    },
    {
      "label": "6",
      "type": "exec",
      "source": "8:str_replace_editor\nstr_replace",
      "target": "7:python",
      "key": 0
    }
  ]
}