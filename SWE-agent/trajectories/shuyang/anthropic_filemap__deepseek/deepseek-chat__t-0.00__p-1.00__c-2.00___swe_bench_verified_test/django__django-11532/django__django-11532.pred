{"model_name_or_path": "deepseek-chat__t-0.00__p-1.00__c-2.00___swe_bench_verified_test", "instance_id": "django__django-11532", "model_patch": "diff --git a/django/core/mail/message.py b/django/core/mail/message.py\nindex e393b4cf5c..e46b14a92c 100644\n--- a/django/core/mail/message.py\n+++ b/django/core/mail/message.py\n@@ -256,8 +256,17 @@ class EmailMessage:\n             # will get picked up by formatdate().\n             msg['Date'] = formatdate(localtime=settings.EMAIL_USE_LOCALTIME)\n         if 'message-id' not in header_names:\n-            # Use cached DNS_NAME for performance\n-            msg['Message-ID'] = make_msgid(domain=DNS_NAME)\n+            # Convert DNS_NAME to Punycode for compatibility with non-ASCII domains\n+            import idna\n+            try:\n+                if DNS_NAME:\n+                    punycode_domain = idna.encode(DNS_NAME).decode('ascii')\n+                    msg['Message-ID'] = make_msgid(domain=punycode_domain)\n+                else:\n+                    msg['Message-ID'] = make_msgid()\n+            except (idna.IDNAError, UnicodeError):\n+                # Fallback to default domain if encoding fails\n+                msg['Message-ID'] = make_msgid()\n         for name, value in self.extra_headers.items():\n             if name.lower() != 'from':  # From is already handled\n                 msg[name] = value\ndiff --git a/reproduce_error.py b/reproduce_error.py\nnew file mode 100644\nindex 0000000000..d33995ee9b\n--- /dev/null\n+++ b/reproduce_error.py\n@@ -0,0 +1,16 @@\n+import os\n+from unittest.mock import patch\n+from django.core.mail import EmailMessage\n+from django.conf import settings\n+\n+# Minimal Django settings configuration\n+settings.configure(\n+    EMAIL_USE_LOCALTIME=False,\n+)\n+\n+# Simulate a non-ASCII hostname\n+with patch(\"django.core.mail.message.DNS_NAME\", \"\u6f22\u5b57\"):\n+    email = EmailMessage('subject', '', 'from@example.com', ['to@example.com'])\n+    email.encoding = 'iso-8859-1'\n+    message = email.message()\n+    print(message['Message-ID'])\n\\ No newline at end of file\n"}