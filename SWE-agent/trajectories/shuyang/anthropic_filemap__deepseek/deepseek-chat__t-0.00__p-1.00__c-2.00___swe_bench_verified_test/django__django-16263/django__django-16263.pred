{"model_name_or_path": "deepseek-chat__t-0.00__p-1.00__c-2.00___swe_bench_verified_test", "instance_id": "django__django-16263", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 9735ce10c8..b41cc935e6 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -550,6 +550,23 @@ class Query(BaseExpression):\n         Perform a COUNT() query using the current filter constraints.\n         \"\"\"\n         obj = self.clone()\n+        # Strip unused annotations (not referenced in filters, other annotations, or ordering).\n+        if obj.annotations:\n+            used_annotations = set()\n+            # Check annotations used in filters.\n+            if obj.where:\n+                for child in obj.where.children:\n+                    if hasattr(child, \"lhs\"):\n+                        if hasattr(child.lhs, \"name\") and child.lhs.name in obj.annotations:\n+                            used_annotations.add(child.lhs.name)\n+            # Check annotations used in ordering.\n+            for order in obj.order_by:\n+                if order.lstrip('-') in obj.annotations:\n+                    used_annotations.add(order.lstrip('-'))\n+            # Remove unused annotations.\n+            unused_annotations = set(obj.annotations.keys()) - used_annotations\n+            for annotation in unused_annotations:\n+                del obj.annotations[annotation]\n         obj.add_annotation(Count(\"*\"), alias=\"__count\", is_summary=True)\n         return obj.get_aggregation(using, [\"__count\"])[\"__count\"]\n \n"}