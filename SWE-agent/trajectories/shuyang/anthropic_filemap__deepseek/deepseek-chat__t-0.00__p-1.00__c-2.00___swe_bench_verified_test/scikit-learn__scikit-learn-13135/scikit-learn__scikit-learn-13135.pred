{"model_name_or_path": "deepseek-chat__t-0.00__p-1.00__c-2.00___swe_bench_verified_test", "instance_id": "scikit-learn__scikit-learn-13135", "model_patch": "diff --git a/sklearn/preprocessing/_discretization.py b/sklearn/preprocessing/_discretization.py\nindex dd969c12b..bf8e63f90 100644\n--- a/sklearn/preprocessing/_discretization.py\n+++ b/sklearn/preprocessing/_discretization.py\n@@ -252,7 +252,10 @@ class KBinsDiscretizer(BaseEstimator, TransformerMixin):\n             rtol = 1.e-5\n             atol = 1.e-8\n             eps = atol + rtol * np.abs(Xt[:, jj])\n-            Xt[:, jj] = np.digitize(Xt[:, jj] + eps, bin_edges[jj][1:])\n+            edges = bin_edges[jj][1:]\n+            if self.strategy == 'kmeans':\n+                edges = np.sort(edges)\n+            Xt[:, jj] = np.digitize(Xt[:, jj] + eps, edges)\n         np.clip(Xt, 0, self.n_bins_ - 1, out=Xt)\n \n         if self.encode == 'ordinal':\n"}