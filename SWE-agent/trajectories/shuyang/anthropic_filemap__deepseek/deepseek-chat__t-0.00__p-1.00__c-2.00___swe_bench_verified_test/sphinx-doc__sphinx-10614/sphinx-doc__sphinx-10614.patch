diff --git a/sphinx/directives/code.py b/sphinx/directives/code.py
index dc44ed314..19724d509 100644
--- a/sphinx/directives/code.py
+++ b/sphinx/directives/code.py
@@ -356,7 +356,20 @@ class LiteralIncludeReader:
 
     def dedent_filter(self, lines: List[str], location: Tuple[str, int] = None) -> List[str]:
         if 'dedent' in self.options:
-            return dedent_lines(lines, self.options.get('dedent'), location=location)
+            # Skip dedent for prepend and append lines
+            prepend = self.options.get('prepend')
+            append = self.options.get('append')
+            if prepend or append:
+                # Separate prepend/append lines from the rest
+                main_lines = lines[1:-1] if append else lines[1:]
+                main_lines = dedent_lines(main_lines, self.options.get('dedent'), location=location)
+                if prepend:
+                    main_lines.insert(0, lines[0])
+                if append:
+                    main_lines.append(lines[-1])
+                return main_lines
+            else:
+                return dedent_lines(lines, self.options.get('dedent'), location=location)
         else:
             return lines
 
diff --git a/tox.ini b/tox.ini
index f0afd779b..30ca90275 100644
--- a/tox.ini
+++ b/tox.ini
@@ -28,7 +28,7 @@ setenv =
     PYTHONWARNINGS = all
     PYTEST_ADDOPTS = {env:PYTEST_ADDOPTS:} --color yes
 commands=
-    python -X dev -m pytest --durations 25 {posargs}
+    python -X dev -m pytest -rA --durations 25 {posargs}
 
 [testenv:du-latest]
 commands =
